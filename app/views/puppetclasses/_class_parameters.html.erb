<% lookup_keys = overridable_lookup_keys(puppetclass, obj) %>
<% lookup_keys.each_with_index do |lookup_key, index| %>
  <% lookup_value = lookup_value(obj, lookup_key) %>
  <% overridden = lookup_key.overridden?(obj) %>
  <% disabled = can_edit_params? && !overridden %>
  <% error = lookup_value.errors %>
  <tr id="puppetclass_<%= puppetclass.id %>_params[<%= lookup_key.id %>]"
    class="fields <%= 'overridden' if overridden %>">
    <%= content_tag(:td, puppetclass.name, :rowspan => lookup_keys.size, :class => "ellipsis") if index == 0 %>
    <td class="ellipsis param_name">
      <%= lookup_key.key %>
    </td>
    <td <%= "class=has-error" if error.present? %>>
      <div class="input-group">
        <%= lookup_key_with_diagnostic(obj, lookup_key, lookup_value) %>
        <span class="input-group-btn">
          <%= fullscreen_button("$(this).parent().prev()") %>
          <%= override_toggle(overridden) %>
        </span>
      </div>
      <%= content_tag(:span, error.full_messages.to_sentence, :class => "help-block") if error.present? %>
    <td class="ca">
      <%= use_puppet_default_check_box(lookup_key, lookup_value, disabled) %>
      <%= hidden_lookup_value_fields(lookup_key, lookup_value, disabled) %>
    </td>
  </tr>
<% end %>
