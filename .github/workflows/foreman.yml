---
name: Foreman

on:
  - pull_request

jobs:
  setup_matrix:
    name: Setup matrix
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.build_matrix.outputs.matrix }}
    steps:
      - name: Build test matrix
        id: build_matrix
        uses: theforeman/gha-matrix-builder@v0
  units:
    needs: setup_matrix
    uses: ./.github/workflows/foreman_tests.yml
    with:
      rake-task: test:units
      matrix: ${{ needs.setup_matrix.outputs.matrix }}
  functionals:
    needs: setup_matrix
    uses: ./.github/workflows/foreman_tests.yml
    with:
      rake-task: test:functionals
      matrix: ${{ needs.setup_matrix.outputs.matrix }}
  graphql:
    needs: setup_matrix
    uses: ./.github/workflows/foreman_tests.yml
    with:
      rake-task: test:graphql
      matrix: ${{ needs.setup_matrix.outputs.matrix }}
